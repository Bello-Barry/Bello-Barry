<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Un site où vous pouvez consulter et ajouter des films hébergés sur YouTube.">
    <title>Mon Site de Films</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        .container {
            width: 80%;
            margin: auto;
            overflow: hidden;
            padding: 20px;
        }
        header {
            background: #35424a;
            color: white;
            padding-top: 30px;
            min-height: 70px;
            border-bottom: #e8491d 3px solid;
        }
        header a {
            color: #ffffff;
            text-decoration: none;
            text-transform: uppercase;
            font-size: 16px;
        }
        header ul {
            padding: 0;
            list-style: none;
        }
        header li {
            display: inline;
            padding: 0 20px 0 20px;
        }
        header #branding {
            float: left;
        }
        header #branding h1 {
            margin: 0;
        }
        header nav {
            float: right;
            margin-top: 10px;
        }
        .movie {
            background: #fff;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .movie h3 {
            margin-top: 0;
            color: #35424a;
        }
        .movie .category {
            font-style: italic;
            color: #777;
        }
        form {
            background: #fff;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        form input[type="text"], form textarea, form select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        form input[type="submit"], .button {
            background: #e8491d;
            color: #fff;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .button {
            display: inline-block;
            text-decoration: none;
            margin-top: 10px;
        }
        #message {
            padding: 10px;
            margin-top: 10px;
            background-color: #4CAF50;
            color: white;
            display: none;
            border-radius: 4px;
        }
        #category-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        .category-button {
            background: #35424a;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
        }
        .category-button.active {
            background: #e8491d;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div id="branding">
                <h1>Mon Site de Films</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="#home">Accueil</a></li>
                    <li><a href="#categories">Catégories</a></li>
                    <li><a href="#add-movie">Ajouter un film</a></li>
                    <li><a href="#about">À propos</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="container" id="home">
        <h2>Mes Films</h2>
        <div id="movie-list">
            <!-- Les films seront ajoutés ici dynamiquement -->
        </div>
    </div>

    <div class="container" id="categories" style="display: none;">
        <h2>Catégories</h2>
        <div id="category-list">
            <!-- Les catégories seront ajoutées ici dynamiquement -->
        </div>
        <div id="category-movies">
            <!-- Les films de la catégorie sélectionnée seront affichés ici -->
        </div>
    </div>

    <div class="container" id="add-movie" style="display: none;">
        <h2>Ajouter un nouveau film</h2>
        <form id="add-movie-form">
            <input type="text" id="movie-title" aria-label="Titre du film" placeholder="Titre du film" required>
            <input type="text" id="movie-category" aria-label="Catégorie du film" placeholder="Catégorie du film" required>
            <input type="text" id="movie-link" aria-label="Lien YouTube" placeholder="Lien YouTube" required>
            <textarea id="movie-description" aria-label="Description du film" placeholder="Description du film" required></textarea>
            <input type="submit" value="Ajouter le film">
        </form>
        <div id="message"></div>
    </div>

    <div class="container" id="about" style="display: none;">
        <h2>À propos</h2>
        <p>Bienvenue sur Mon Site de Films, une plateforme où vous pouvez découvrir et partager vos films préférés hébergés sur YouTube. Notre site vous permet de :</p>
        <ul>
            <li>Consulter une variété de films dans différentes catégories</li>
            <li>Ajouter vos propres films à notre collection</li>
            <li>Explorer les films par catégorie</li>
        </ul>
        <p>Nous espérons que vous apprécierez votre expérience sur notre site !</p>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js"></script>
    <script>
        // Configuration de Firebase
        const firebaseConfig = {
            apiKey: "VOTRE_API_KEY",
            authDomain: "VOTRE_AUTH_DOMAIN",
            projectId: "VOTRE_PROJECT_ID",
            storageBucket: "VOTRE_STORAGE_BUCKET",
            messagingSenderId: "VOTRE_MESSAGING_SENDER_ID",
            appId: "VOTRE_APP_ID"
        };

        // Initialiser Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Liste initiale de films
        let movies = [];

        // Fonction pour ajouter un film
        function addMovie(title, category, link, description) {
            if (!getYouTubeId(link)) {
                showMessage("Lien YouTube invalide");
                return;
            }
            const movie = { title, category, link, description };
            db.collection("movies").add(movie) // Ajouter le film à Firestore
                .then(() => {
                    movies.push(movie);
                    displayMovies();
                    updateCategories();
                    showMessage("Film ajouté avec succès!");
                    navigateTo('home');
                })
                .catch(error => {
                    console.error("Erreur lors de l'ajout du film: ", error);
                    showMessage("Erreur lors de l'ajout du film.");
                });
        }

        // Fonction pour afficher les films
        function displayMovies(category = null) {
            const movieList = document.getElementById(category ? 'category-movies' : 'movie-list');
            movieList.innerHTML = '';
            movies.forEach(movie => {
                if (!category || movie.category === category) {
                    const movieElement = document.createElement('div');
                    movieElement.className = 'movie';
                    movieElement.innerHTML = `
                        <h3>${movie.title}</h3>
                        <p class="category">Catégorie: ${movie.category}</p>
                        <iframe sandbox="allow-scripts allow-same-origin" width="100%" height="315" src="https://www.youtube.com/embed/${getYouTubeId(movie.link)}" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
                        <p>${movie.description}</p>
                    `;
                    movieList.appendChild(movieElement);
                }
            });
        }

        // Fonction pour mettre à jour les catégories
        function updateCategories() {
            const categoryList = document.getElementById('category-list');
            const categories = [...new Set(movies.map(movie => movie.category))];
            categoryList.innerHTML = '';
            categories.forEach(category => {
                const button = document.createElement('button');
                button.className = 'category-button';
                button.textContent = category;
                button.addEventListener('click', () => {
                    document.querySelectorAll('.category-button').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    displayMovies(category);
                });
                categoryList.appendChild(button);
            });
        }

        // Fonction pour extraire l'ID YouTube d'un lien
        function getYouTubeId(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }

        // Fonction pour afficher un message
        function showMessage(msg) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = msg;
            messageDiv.style.display = 'block';
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 3000);
        }

        // Fonction pour naviguer entre les pages
        function navigateTo(pageId) {
            document.querySelectorAll('.container').forEach(container => {
                container.style.display = 'none';
            });
            document.getElementById(pageId).style.display = 'block';
        }

        // Fonction pour charger les films depuis Firestore
        function loadMovies() {
            db.collection("movies").get().then(querySnapshot => {
                movies = [];
                querySnapshot.forEach(doc => {
                    movies.push({ id: doc.id, ...doc.data() });
                });
                displayMovies();
                updateCategories();
            });
        }

        // Gestion du formulaire d'ajout de film
        document.getElementById('add-movie-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const title = document.getElementById('movie-title').value;
            const category = document.getElementById('movie-category').value;
            const link = document.getElementById('movie-link').value;
            const description = document.getElementById('movie-description').value;
            addMovie(title, category, link, description);
            this.reset();
        });

        // Navigation
        document.querySelectorAll('header a').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                navigateTo(this.getAttribute('href').substr(1));
            });
        });

        // Initialisation
        loadMovies();
    </script>
</body>
</html>
